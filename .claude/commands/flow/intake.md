---
description: Process INITIAL feature intake documents to create backlog tasks with full context memory.
mode: agent
loop: outer
# Loop Classification: OUTER LOOP
# This command processes feature intake documents and creates backlog tasks. It's part
# of the outer loop planning phase, preparing features for the SDD workflow.
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Execution Instructions

This command processes INITIAL-style feature intake documents and bootstraps the feature workflow by:
1. Parsing the INITIAL document structure
2. Creating a backlog task with extracted information
3. Creating a task memory file with full context

**Note**: This command is DIFFERENT from `/flow:init` which handles project constitution initialization. This command handles per-feature intake from INITIAL documents.

### Step 1: Locate INITIAL Document

Determine the path to the INITIAL document:

```bash
# If user provided a path argument, use it
# Otherwise, check for default location
INITIAL_PATH="${ARGUMENTS:-}"

if [ -z "$INITIAL_PATH" ]; then
  echo "ERROR: No INITIAL document path provided"
  echo ""
  echo "Usage: /flow:intake <path-to-initial-doc>"
  echo ""
  echo "Example:"
  echo "  /flow:intake docs/features/user-auth-initial.md"
  echo ""
  echo "To create an INITIAL document first:"
  echo "  cp .flowspec/templates/docs/initial/initial-feature-template.md docs/features/<feature>-initial.md"
  exit 1
fi

if [ ! -f "$INITIAL_PATH" ]; then
  echo "ERROR: INITIAL document not found at: $INITIAL_PATH"
  exit 1
fi

echo "Processing INITIAL document: $INITIAL_PATH"
```

If no path is provided, inform the user how to use the command and exit.

### Step 2: Parse INITIAL Document

Read the INITIAL document and extract key sections:

**Parse these sections from the document:**

#### From FEATURE Section:
- **Feature Name**: From the `# INITIAL: {{FEATURE_NAME}}` header
- **Problem Statement**: From `### Problem Statement`
- **Desired Outcome**: From `### Desired Outcome`
- **Key Constraints**: From `### Key Constraints`
- **Why This Matters**: From `### Why This Matters`

#### From EXAMPLES Section:
- **Example Files Table**: Files listed in the examples table
- **Usage Patterns**: Pattern references
- **Expected Behavior**: Example scenarios

#### From DOCUMENTATION Section:
- **Internal Docs**: PRDs, ADRs, Architecture docs
- **External References**: URLs and external specs
- **Related Tasks**: Previous task IDs

#### From OTHER CONSIDERATIONS Section:
- **Known Gotchas**: Pitfalls and mitigations
- **Previous Failures**: What was tried and why it failed
- **Dependencies**: What this depends on
- **Security Considerations**: Security requirements
- **Performance Requirements**: Performance targets
- **Edge Cases**: Boundary conditions

### Step 3: Create Backlog Task

Use the backlog CLI to create a new task with the extracted information:

```bash
# Generate task title from feature name
FEATURE_NAME="[Extracted from INITIAL header]"
TASK_TITLE="Implement: $FEATURE_NAME"

# Create task description combining problem + outcome
TASK_DESCRIPTION="**Problem**: [Problem Statement from INITIAL]

**Desired Outcome**: [Desired Outcome from INITIAL]

**Why It Matters**: [Why This Matters from INITIAL]

**Constraints**:
[Key Constraints from INITIAL]

**Source Document**: $INITIAL_PATH"

# Create the task with backlog CLI
backlog task create "$TASK_TITLE" \
  -d "$TASK_DESCRIPTION" \
  --ac "All acceptance criteria from PRD are met" \
  --ac "Implementation follows documented patterns" \
  --ac "Tests cover edge cases" \
  --ac "Documentation updated" \
  -l intake,feature \
  --priority medium
```

**Capture the task ID** from the CLI output (e.g., `task-XXX`).

### Step 4: Create Task Memory File

Create a comprehensive memory file for the task at `backlog.flowspec/memory/<task-id>.md`:

```markdown
# Task Memory: {{TASK_ID}}

> Auto-generated from INITIAL document: {{INITIAL_PATH}}
> Generated by: /flow:intake
> Generated at: {{TIMESTAMP}}

## What & Why

### Problem Statement
{{PROBLEM_STATEMENT}}

### Desired Outcome
{{DESIRED_OUTCOME}}

### Why This Matters
{{WHY_IT_MATTERS}}

## Constraints

{{KEY_CONSTRAINTS}}

## Examples & Patterns

### Example Files
{{EXAMPLES_TABLE}}

### Usage Patterns
{{USAGE_PATTERNS}}

### Expected Behavior
{{EXPECTED_BEHAVIOR}}

## Documentation References

### Internal Docs
{{INTERNAL_DOCS_TABLE}}

### External References
{{EXTERNAL_REFS_TABLE}}

### Related Tasks
{{RELATED_TASKS_TABLE}}

## Initial Gotchas

### Known Gotchas
{{KNOWN_GOTCHAS}}

### Previous Failures
{{PREVIOUS_FAILURES}}

### Dependencies
{{DEPENDENCIES}}

### Security Considerations
{{SECURITY_CONSIDERATIONS}}

### Performance Requirements
{{PERFORMANCE_REQUIREMENTS}}

### Edge Cases
{{EDGE_CASES}}

---

*Memory file generated from: {{INITIAL_PATH}}*
*Associated task: {{TASK_ID}}*
```

Write this file to `backlog.flowspec/memory/<task-id>.md`.

### Step 5: Output Summary

After processing, display a summary:

```
Feature Intake Complete!

Created:
  Task: task-XXX - "Implement: [Feature Name]"
  Memory: backlog.flowspec/memory/task-XXX.md

Next Steps:
  1. Review the task: backlog task task-XXX --plain
  2. Assess complexity: /flow:assess task-XXX
  3. Create specification: /flow:specify task-XXX

INITIAL Document: $INITIAL_PATH
```

### Error Handling

Handle these error cases:
- INITIAL document not found
- Document doesn't have expected sections
- Backlog CLI not available
- Task creation fails
- Memory file write fails

For missing sections, use placeholders:
```
[Section not provided in INITIAL document]
```

### Example Usage

```bash
# Process a specific INITIAL document
/flow:intake docs/features/user-authentication-initial.md

# Process with relative path
/flow:intake ./docs/features/api-rate-limiting-initial.md
```

## Deliverables

This command produces:
1. **Backlog Task**: New task with title, description, and initial ACs
2. **Memory File**: Comprehensive context file at `backlog.flowspec/memory/<task-id>.md`
3. **Summary**: Clear output showing what was created and next steps

## Post-Completion

After intake completes, the task is ready for the SDD workflow:
- `/flow:assess` - Evaluate complexity
- `/flow:specify` - Create detailed PRD
- `/flow:plan` - Technical design
- `/flow:implement` - Implementation
